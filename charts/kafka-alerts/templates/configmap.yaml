# templates/configmap.yaml
{{- if .Values.grafana.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kafka-alerts.fullname" . }}-configmap
  labels:
    {{- include "kafka-alerts.labels" . | nindent 4 }}
data:
  grafana-json.json: |-
    {
      "dashboard": {
        "__inputs": [],
        "__requires": [
          {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "{{ .Values.grafana.version }}"
          },
          {
            "type": "panel",
            "id": "graph",
            "name": "Graph",
            "version": ""
          }
        ],
        "annotations": {
          "list": [
            {
              "builtIn": 1,
              "datasource": "-- Grafana --",
              "enable": true,
              "hide": true,
              "iconColor": "rgba(0, 211, 255, 1)",
              "name": "Annotations & Alerts",
              "type": "dashboard"
            }
          ]
        },
        "editable": true,
        "gnetId": null,
        "graphTooltip": 0,
        "id": null,
        "links": [],
        "panels": [
          {
            "collapsed": true,
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            },
            "gridPos": {
              "h": 1,
              "w": 24,
              "x": 0,
              "y": 0
            },
            "id": 28,
            "panels": [
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "1h",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Down alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 1
                },
                "hiddenSeries": false,
                "id": 14,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "exemplar": true,
                    "expr": "kubedb_com_kafka_status_phase{app=\"{{ .Release.Name }}\",namespace=\"{{ .Release.Namespace }}\",phase=\"NotReady\"}",
                    "interval": "",
                    "legendFormat": "",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Down",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "$$hashKey": "object:88",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  },
                  {
                    "$$hashKey": "object:89",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false
                }
              },
              {
                "alert": {
                  "alertRuleTags": {
                    "kdb": ""
                  },
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "1h",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "KafkaPhaseCritical",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 1
                },
                "hiddenSeries": false,
                "id": 2,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "exemplar": true,
                    "expr": "kubedb_com_kafka_status_phase{app=\"{{ .Release.Name }}\", namespace=\"{{ .Release.Namespace }}\",phase=\"Critical\"}",
                    "interval": "",
                    "legendFormat": "",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Critical Phase",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "$$hashKey": "object:70",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  },
                  {
                    "$$hashKey": "object:71",
                    "format": "short",
                    "logBase": 1,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false
                }
              }
            ],
            "title": "Kafka Phase",
            "type": "row"
          },
          {
            "collapsed": true,
            "datasource": null,
            "gridPos": {
              "h": 1,
              "w": 24,
              "x": 0,
              "y": 1
            },
            "id": 56,
            "panels": [
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "1m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "avg"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Under Replicated Partitions alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka under replicated partitions",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 2
                },
                "hiddenSeries": false,
                "id": 34,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "exemplar": true,
                    "expr": "kafka_server_replicamanager_underreplicatedpartitions{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}",
                    "instant": false,
                    "interval": "",
                    "legendFormat": "",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Under Replicated Partitions",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Offline Partitions alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka offline partitions",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 2
                },
                "hiddenSeries": false,
                "id": 36,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "sum(kafka_controller_kafkacontroller_offlinepartitionscount{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"})",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Offline Partitions",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          1000
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Topic Count alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka topic count reached threshold",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 10
                },
                "hiddenSeries": false,
                "id": 54,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "count(count(kafka_server_brokertopicmetrics_messagesin_total{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}) by (topic,service)) by (service)",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 1000,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Topic Count",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Under Min ISR Partition Count alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": " Kafka under min ISR partitions",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 10
                },
                "hiddenSeries": false,
                "id": 38,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "kafka_server_replicamanager_underminisrpartitioncount{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Under Min ISR Partition Count",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          50
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Replica Fetcher Manager Max Lag alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Replica Fetcher Manager Max Lag",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 18
                },
                "hiddenSeries": false,
                "id": 52,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "avg(kafka_server_replicafetchermanager_maxlag{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}) by (service)",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 50,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Replica Fetcher Manager Max Lag",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Offline Log Directory Count alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka offline log directories",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 18
                },
                "hiddenSeries": false,
                "id": 40,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "kafka_log_logmanager_offlinelogdirectorycount{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Offline Log Directory Count",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0.3
                        ],
                        "type": "lt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Request Handler Idle Percent alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka Request Handler Idle Percent",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 26
                },
                "hiddenSeries": false,
                "id": 50,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "avg(sum(kafka_network_processor_idle_percent{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}) by (networkProcessor)) by (service_name)",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "lt",
                    "value": 0.3,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Request Handler Idle Percent",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka ISR Expand Rate alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka ISR Expansion Rate",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 26
                },
                "hiddenSeries": false,
                "id": 42,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "sum(irate(kafka_server_replicamanager_isrexpands_total{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}[5m])) by (service)",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka ISR Expand Rate",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          1
                        ],
                        "type": "lt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Broker Count alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka Brokers online!",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 34
                },
                "hiddenSeries": false,
                "id": 46,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "count(kafka_server_kafkaserver_brokerstate{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"})",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "lt",
                    "value": 1,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Broker Count",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0
                        ],
                        "type": "gt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "5m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka ISR Shrink Rate alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka ISR Shrink Rate",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 12,
                  "y": 34
                },
                "hiddenSeries": false,
                "id": 44,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "exemplar": true,
                    "expr": "sum(irate(kafka_server_replicamanager_isrshrinks_total{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}[5m])) by (service)",
                    "interval": "",
                    "legendFormat": "",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "gt",
                    "value": 0,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka ISR Shrink Rate",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              },
              {
                "alert": {
                  "alertRuleTags": {},
                  "conditions": [
                    {
                      "evaluator": {
                        "params": [
                          0.3
                        ],
                        "type": "lt"
                      },
                      "operator": {
                        "type": "and"
                      },
                      "query": {
                        "params": [
                          "A",
                          "1m",
                          "now"
                        ]
                      },
                      "reducer": {
                        "params": [],
                        "type": "last"
                      },
                      "type": "query"
                    }
                  ],
                  "executionErrorState": "alerting",
                  "for": "10s",
                  "frequency": "10s",
                  "handler": 1,
                  "name": "Kafka Network Processor Idle Percent alert",
                  "noDataState": "no_data",
                  "notifications": []
                },
                "aliasColors": {},
                "bars": false,
                "dashLength": 10,
                "dashes": false,
                "datasource": null,
                "description": "Kafka Network Processor Idle Percent",
                "fill": 1,
                "fillGradient": 0,
                "gridPos": {
                  "h": 8,
                  "w": 12,
                  "x": 0,
                  "y": 42
                },
                "hiddenSeries": false,
                "id": 48,
                "legend": {
                  "avg": false,
                  "current": false,
                  "max": false,
                  "min": false,
                  "show": true,
                  "total": false,
                  "values": false
                },
                "lines": true,
                "linewidth": 1,
                "nullPointMode": "null",
                "options": {
                  "alertThreshold": true
                },
                "percentage": false,
                "pluginVersion": "8.2.3",
                "pointradius": 2,
                "points": false,
                "renderer": "flot",
                "seriesOverrides": [],
                "spaceLength": 10,
                "stack": false,
                "steppedLine": false,
                "targets": [
                  {
                    "datasource": {
                      "type": "prometheus",
                      "uid": "prometheus"
                    },
                    "expr": "avg(sum(kafka_network_processor_idle_percent{job=~\"{{ .Release.Name }}-stats\",namespace=~\"{{ .Release.Namespace }}\"}) by (networkProcessor)) by (service_name)",
                    "refId": "A"
                  }
                ],
                "thresholds": [
                  {
                    "colorMode": "critical",
                    "fill": true,
                    "line": true,
                    "op": "lt",
                    "value": 0.3,
                    "visible": true
                  }
                ],
                "timeFrom": null,
                "timeRegions": [],
                "timeShift": null,
                "title": "Kafka Network Processor Idle Percent",
                "tooltip": {
                  "shared": true,
                  "sort": 0,
                  "value_type": "individual"
                },
                "type": "graph",
                "xaxis": {
                  "buckets": null,
                  "mode": "time",
                  "name": null,
                  "show": true,
                  "values": []
                },
                "yaxes": [
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  },
                  {
                    "format": "short",
                    "label": null,
                    "logBase": 1,
                    "max": null,
                    "min": null,
                    "show": true
                  }
                ],
                "yaxis": {
                  "align": false,
                  "alignLevel": null
                }
              }
            ],
            "title": "Kafka Server Status",
            "type": "row"
          }
        ],
        "schemaVersion": 27,
        "style": "dark",
        "tags": [],
        "templating": {
          "list": []
        },
        "time": {
          "from": "now-15m",
          "to": "now"
        },
        "timepicker": {},
        "timezone": "",
        "title": "{{ .Values.metadata.resource.group }} / {{ .Values.metadata.resource.kind }} / {{ .Release.Namespace }} / {{ .Release.Name }}",
        "uid": null,
        "version": 23
      },
      "folderId": 0,
      "overwrite": false
    }
{{- end }}